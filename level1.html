<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Remi's Semi - Level 1</title>
    <style>
        body { margin: 0; background: #2d613e; font-family: 'Segoe UI', sans-serif; overflow: hidden; color: white; touch-action: none; height: 100vh; width: 100vw; }
        canvas { display: block; width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; }
        #gameCanvas { z-index: 1; }
        #dashboard { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); z-index: 10; pointer-events: none; text-align: center; width: 100%; }
        #msg { font-size: 18px; color: #ffd700; text-shadow: 2px 2px #000; font-weight: bold; margin-bottom: 5px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 15px; display: inline-block; width: 94%; line-height: 1.2; box-sizing: border-box; border: 1px solid #444; }
        #bottom-stats { display: flex; justify-content: center; gap: 10px; margin-top: 5px; }
        .stat-box { background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 5px; border: 1px solid #444; font-family: monospace; font-size: 16px; }
        
        /* UPDATED: Adjusted padding and alignment to keep controls on screen for iPhone */
        #controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-between; align-items: flex-end; padding: 0 20px; box-sizing: border-box; z-index: 10; pointer-events: none; }
        .left-controls { display: flex; flex-direction: column; gap: 10px; align-items: flex-start; pointer-events: auto; }
        .pedal-box { display: flex; gap: 8px; }
        
        /* FIXED: Narrowed steering pad and wheel size to prevent it from going off-screen */
        #steering-pad { width: 140px; height: 140px; background: rgba(0,0,0,0.1); border-radius: 50%; position: relative; touch-action: none; pointer-events: auto; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; }
        #steering-wheel { width: 130px; height: 130px; border: 15px solid #1a1a1a; border-radius: 50%; box-sizing: border-box; position: relative; transition: transform 0.1s linear; box-shadow: inset 0 0 10px #000, 0 4px 10px rgba(0,0,0,0.5); pointer-events: none; }
        #steering-wheel::before { content: ""; position: absolute; top: 50%; left: -15px; width: 130px; height: 18px; background: #1a1a1a; transform: translateY(-50%); border-radius: 4px; }
        #steering-wheel::after { content: ""; position: absolute; left: 50%; top: 50%; width: 35px; height: 35px; background: #222; border-radius: 50%; transform: translate(-50%, -50%); border: 3px solid #333; box-shadow: 0 2px 5px #000; }

        .btn { width: 70px; height: 60px; background: rgba(51,51,51,0.8); border: 2px solid #555; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 13px; color: white; user-select: none; pointer-events: auto; }
        #btnStart { background: rgba(80,0,0,0.8); border-color: #f00; height: 40px; font-weight: bold; }
        #btnStart.on { background: rgba(0,80,0,0.8); border-color: #0f0; }
        #btnView { height: 40px; font-size: 10px; background: rgba(0, 100, 200, 0.8); }
    </style>
</head>
<body>

<div id="dashboard">
    <div id="msg">YOUR TASK: DROP THE TRAILER IN THE MAIN YARD</div>
    <div id="bottom-stats">
        <div class="stat-box" style="color: #0f0;">TYPE: <span id="trailerType">BOX</span></div>
        <div class="stat-box" style="color: #ffd700;">ATTACHED: <span id="attachStatus">YES</span></div>
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<div id="controls">
    <div class="left-controls">
        <div class="pedal-box">
            <div id="btnDown" class="btn">REV</div>
            <div id="btnUp" class="btn">GAS</div>
        </div>
        <div style="display: flex; gap: 8px; margin-top: 5px;">
            <button id="btnStart" class="btn">START</button>
            <button id="btnView" class="btn">VIEW</button>
            <button id="btnDrop" class="btn" style="height:40px; font-size: 10px; background: rgba(200, 100, 0, 0.8);">DROP/HOOK</button>
        </div>
    </div>
    <div id="steering-pad"><div id="steering-wheel"></div></div>
</div>

<script>
const roadY = 850;
const scale1km = 3000;
const yard = { x: 500, y: roadY - scale1km - 1500, w: 3250, h: 1500 };

const trees = [];
for(let i=0; i<80; i++) {
    trees.push({ x: Math.random() * 8000 - 2000, y: Math.random() * -8000 + 800, s: 40 + Math.random() * 30 });
}

const houses = [
    { x: -800, y: 300, w: 180, h: 140, roof: "#4a3b2a" },
    { x: 1500, y: -200, w: 200, h: 150, roof: "#2a3b4a" }
];

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const padEl = document.getElementById("steering-pad");
const wheelEl = document.getElementById("steering-wheel");
const startBtn = document.getElementById("btnStart");
const viewBtn = document.getElementById("btnView");

let engineOn = false;
let steerInput = 0;
const touch = { up: false, down: false };
let currentZoom = 0.45;

const tractor = { x: 0, y: 1055, w: 292.5, h: 67.5, angle: 0, speed: 0, accel: 0.05, revAccel: 0.04, friction: 0.98, steerAngle: 0 };
const camera = { x: 0, y: 0 };

let allTrailers = [
    { x: -280, y: 1055, w: 417, h: 72, angle: 0, type: 'box' },
    { x: yard.x + 1900, y: yard.y + 750, w: 417, h: 72, angle: Math.PI/2, type: 'flatbed' },
    { x: yard.x + 2200, y: yard.y + 750, w: 417, h: 72, angle: Math.PI/2, type: 'box' },
    { x: yard.x + 2500, y: yard.y + 750, w: 417, h: 72, angle: Math.PI/2, type: 'flatbed' }
];
let activeTrailer = allTrailers[0];

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize);
resize();

function drawTopDownTree(x, y, s) {
    ctx.fillStyle = "#1b4026";
    ctx.beginPath(); ctx.arc(x, y, s, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = "#2d613e";
    ctx.beginPath(); ctx.arc(x, y, s*0.7, 0, Math.PI*2); ctx.fill();
}

function drawCar(x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x, y, 60, 35);
    ctx.fillStyle = "#111";
    ctx.fillRect(x + 10, y - 2, 12, 4); ctx.fillRect(x + 40, y - 2, 12, 4);
    ctx.fillRect(x + 10, y + 33, 12, 4); ctx.fillRect(x + 40, y + 33, 12, 4);
    ctx.fillStyle = "#222";
    ctx.fillRect(x + 12, y + 5, 36, 25);
}

function drawTrailerStatic(x, y, angle, type) {
    ctx.save(); ctx.translate(x, y); ctx.rotate(angle);
    ctx.fillStyle = (type === 'box') ? "#ddd" : "#8b4513";
    ctx.fillRect(-417/2, -72/2, 417, 72);
    ctx.fillStyle = "#111"; ctx.fillRect(-417/2 + 20, 72/2, 50, 6); ctx.fillRect(-417/2 + 20, -72/2 - 6, 50, 6);
    ctx.restore();
}

function drawTruckDetailed(x, y, angle, isSteering = false) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle);
    const s = 2.25;
    ctx.fillStyle = "#111";
    ctx.fillRect((-130*s)/2, (-30*s)/6, (130*s) - (50*s), (30*s)/3); 
    ctx.fillRect(0, (-30*s)/2, 60*s, 30*s); 
    ctx.fillStyle = "#000";
    ctx.fillRect(-62*s, -12*s, 12*s, 6*s); ctx.fillRect(-62*s, 6*s, 12*s, 6*s); 
    ctx.fillRect(-45*s, -12*s, 12*s, 6*s); ctx.fillRect(-45*s, 6*s, 12*s, 6*s); 
    ctx.save();
    ctx.translate(45*s, (-30*s)/2 + 0.5);
    if(isSteering) ctx.rotate(tractor.steerAngle);
    ctx.fillRect(-6*s, -2.5*s, 12*s, 5*s); 
    ctx.restore();
    ctx.save();
    ctx.translate(45*s, (30*s)/2 - 0.5);
    if(isSteering) ctx.rotate(tractor.steerAngle);
    ctx.fillRect(-6*s, -2.5*s, 12*s, 5*s); 
    ctx.restore();
    ctx.fillStyle = "#800000";
    ctx.fillRect(-10*s, (-30*s)/2, 40*s, 30*s); 
    ctx.fillRect(30*s, (-30*s)/2 + 4*s, 30*s, (30*s) - 8*s); 
    ctx.fillStyle = "#FFD700";
    for(let i = 0; i < 4; i++) { ctx.fillRect(27*s, (-30*s)/2 + 4*s + (i * 6.5 * s), 3*s, 3*s); }
    ctx.fillStyle = "#777";
    ctx.fillRect(-12*s, (-30*s)/2 - 5*s, 6*s, 6*s); ctx.fillRect(-12*s, (30*s)/2 - 1*s, 6*s, 6*s);  
    ctx.fillStyle = "#aaa";
    ctx.fillRect(30*s, (-30*s)/2 - 4*s, 4*s, 5*s); ctx.fillRect(30*s, (30*s)/2 - 1*s, 4*s, 5*s);  
    ctx.restore();
}

function update() {
    if (engineOn) {
        if (touch.up) tractor.speed += tractor.accel;
        if (touch.down) tractor.speed -= tractor.revAccel;
    }
    tractor.speed *= tractor.friction;
    tractor.angle += (tractor.speed / 150) * Math.tan(tractor.steerAngle);
    tractor.x += Math.cos(tractor.angle) * tractor.speed;
    tractor.y += Math.sin(tractor.angle) * tractor.speed;
    
    if (activeTrailer) {
        const pivotX = tractor.x - Math.cos(tractor.angle) * 101.25;
        const pivotY = tractor.y - Math.sin(tractor.angle) * 101.25;
        const dx = pivotX - activeTrailer.x;
        const dy = pivotY - activeTrailer.y;
        activeTrailer.angle = Math.atan2(dy, dx);
        activeTrailer.x = pivotX - Math.cos(activeTrailer.angle) * (activeTrailer.w / 2 - 33.75);
        activeTrailer.y = pivotY - Math.sin(activeTrailer.angle) * (activeTrailer.w / 2 - 33.75);
    }
    camera.x = tractor.x - (canvas.width / currentZoom) / 2;
    camera.y = tractor.y - (canvas.height / currentZoom) / 2;
}

function draw() {
    ctx.clearRect(0,0, canvas.width, canvas.height);
    ctx.save(); ctx.scale(currentZoom, currentZoom); ctx.translate(-camera.x, -camera.y);
    
    ctx.fillStyle = "#2d613e"; ctx.fillRect(-15000, -20000, 40000, 40000);
    
    ctx.fillStyle = "#333";
    const roadCenterX = yard.x + yard.w/2;
    ctx.fillRect(roadCenterX - 127, yard.y + yard.h, 254, scale1km);
    
    ctx.beginPath(); ctx.arc(roadCenterX - 127, roadY, 150, Math.PI, Math.PI*1.5); ctx.lineTo(roadCenterX - 127, roadY); ctx.fill();
    ctx.beginPath(); ctx.arc(roadCenterX + 127, roadY, 150, 0, Math.PI*1.5, true); ctx.lineTo(roadCenterX + 127, roadY); ctx.fill();

    ctx.strokeStyle = "#ffff00"; ctx.setLineDash([40, 40]); ctx.lineWidth = 4;
    ctx.beginPath(); ctx.moveTo(roadCenterX, yard.y + yard.h); ctx.lineTo(roadCenterX, yard.y + yard.h + scale1km); ctx.stroke();

    trees.forEach(t => drawTopDownTree(t.x, t.y, t.s));
    houses.forEach(h => {
        ctx.fillStyle = h.roof; ctx.fillRect(h.x, h.y, h.w, h.h);
        ctx.strokeStyle = "#000"; ctx.lineWidth = 4; ctx.strokeRect(h.x, h.y, h.w, h.h);
    });

    ctx.fillStyle = "#555"; ctx.fillRect(yard.x, yard.y, yard.w, yard.h);
    ctx.strokeStyle = "#fff"; ctx.setLineDash([]); ctx.lineWidth = 10;
    ctx.strokeRect(yard.x, yard.y, yard.w, yard.h);
    
    ctx.fillStyle = "#444"; ctx.fillRect(yard.x + 50, yard.y + 50, 1000, 750);
    ctx.fillStyle = "#222"; ctx.fillRect(yard.x + 100, yard.y + 700, 800, 100); 

    ctx.fillStyle = "#888"; ctx.fillRect(yard.x + 60, yard.y + 60, 40, 400); ctx.fillRect(yard.x + 950, yard.y + 60, 40, 400);
    ctx.fillStyle = "#111"; for(let i=0; i<6; i++) { ctx.beginPath(); ctx.arc(yard.x+80, yard.y+100+(i*60), 12, 0, Math.PI*2); ctx.fill(); }
    ctx.fillStyle = "#8b5a2b"; ctx.fillRect(yard.x + 450, yard.y + 60, 50, 50); ctx.fillRect(yard.x + 520, yard.y + 60, 50, 50);

    drawTruckDetailed(yard.x + 250, yard.y + 500, Math.PI/2);
    drawTrailerStatic(yard.x + 250, yard.y + 250, Math.PI/2, 'box');
    drawTruckDetailed(yard.x + 750, yard.y + 500, Math.PI/2);
    drawTrailerStatic(yard.x + 750, yard.y + 250, Math.PI/2, 'flatbed');
    
    ctx.fillStyle = "#7a3a3a"; ctx.fillRect(yard.x + 1100, yard.y + 50, 400, 250);
    ctx.strokeStyle = "#000"; ctx.lineWidth = 5; ctx.strokeRect(yard.x + 1100, yard.y + 50, 400, 250);
    drawCar(yard.x + 1150, yard.y + 350, "#ccc"); drawCar(yard.x + 1250, yard.y + 350, "#3366ff"); drawCar(yard.x + 1350, yard.y + 350, "#cc0000");

    ctx.strokeStyle = "#ffd700"; ctx.lineWidth = 3; ctx.setLineDash([10, 5]);
    for(let i=0; i<4; i++) { ctx.strokeRect(yard.x + 1800 + i*350, yard.y + 350, 250, 900); }

    ctx.fillStyle = "#333"; ctx.fillRect(-15000, roadY, 30000, 254);
    ctx.strokeStyle = "#ffff00"; ctx.setLineDash([40, 40]); ctx.lineWidth = 4;
    ctx.beginPath(); ctx.moveTo(-15000, roadY + 127); ctx.lineTo(15000, roadY + 127); ctx.stroke();
    
    drawTruckDetailed(tractor.x, tractor.y, tractor.angle, true);
    allTrailers.forEach(t => {
        ctx.save(); ctx.translate(t.x, t.y); ctx.rotate(t.angle);
        ctx.fillStyle = (t.type === 'box') ? "#ddd" : "#8b4513";
        ctx.fillRect(-t.w/2, -t.h/2, t.w, t.h);
        ctx.fillStyle = "#111"; ctx.fillRect(-t.w/2 + 20, t.h/2, 50, 6);
        ctx.fillRect(-t.w/2 + 20, -t.h/2 - 6, 50, 6);
        ctx.restore();
    });
    ctx.restore();
    update();
    requestAnimationFrame(draw);
}

document.getElementById("btnUp").addEventListener("touchstart", (e) => { e.preventDefault(); touch.up = true; });
document.getElementById("btnUp").addEventListener("touchend", (e) => { e.preventDefault(); touch.up = false; });
document.getElementById("btnDown").addEventListener("touchstart", (e) => { e.preventDefault(); touch.down = true; });
document.getElementById("btnDown").addEventListener("touchend", (e) => { e.preventDefault(); touch.down = false; });

startBtn.onclick = () => { engineOn = !engineOn; startBtn.classList.toggle("on"); startBtn.innerText = engineOn ? "STOP" : "START"; };

viewBtn.onclick = () => {
    currentZoom = (currentZoom === 0.45) ? 0.15 : 0.45;
};

padEl.addEventListener("touchmove", (e) => {
    e.preventDefault();
    const rect = padEl.getBoundingClientRect();
    const center = rect.left + rect.width / 2;
    const t = Array.from(e.touches).find(f => f.clientX > rect.left && f.clientX < rect.right);
    if (t) {
        steerInput = (t.clientX - center) / (rect.width / 2);
        steerInput = Math.max(-1, Math.min(1, steerInput));
        tractor.steerAngle = steerInput * 0.6;
        wheelEl.style.transform = `rotate(${steerInput * 180}deg)`;
    }
}, {passive: false});

padEl.addEventListener("touchend", (e) => {
    const rect = padEl.getBoundingClientRect();
    const stillTouchingWheel = Array.from(e.touches).some(f => f.clientX > rect.left && f.clientX < rect.right);
    if (!stillTouchingWheel) {
        steerInput = 0; tractor.steerAngle = 0; wheelEl.style.transform = `rotate(0deg)`; 
    }
});

draw();
</script>
</body>
</html>
